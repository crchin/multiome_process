# multiome_process
Process and integrate 10x Multiome Data

The following scripts should be used in this order to process the multiome data:

### Create signac environment and install packages if needed

- Create conda environment with this yml file: [environment_signac.yml](https://github.com/crchin/multiome_process/blob/main/environment_signac.yml)
- Install packages in R (within the conda environment) as needed: [99_install_signac_packages.R](https://github.com/crchin/multiome_process/blob/main/99_install_signac_packages.R)

### Create multiome object on cluster from cellranger output path individually (optional)
**Script:** [01_multiome_signac.R](https://github.com/crchin/multiome_process/blob/main/01_multiome_signac.R)

Input arguments:

  - argument 1: cellranger out path
  - argument 2: sample name
  - argument 3: species, human or mouse

*Example Usage:*

```R
Rscript ~/scripts/01_multiome_signac.R /athena/melnicklab/users/scratch/chc2077/ls_multiome/ls_multiome/outs ls_multiome mouse
```

Object will be saved into the cellranger-arc output folder

### Create a csv runsheet that has a unique name for each sample, and a path to cellranger-arc "out" folder
csv runsheet header must contain "Sample" "sobj_path". Additional columns will be added as metadata

Example runsheet included: [Example_runsheet.csv](https://github.com/crchin/multiome_process/blob/main/Example_runsheet.csv)

### Optional - add velocity data
**Script:** [21_multiome_velo.R](https://github.com/crchin/multiome_process/blob/main/21_multiome_velo.R)

This script will add the velocity data to multiome objects. Argument is a path to the runsheet

### Load and combine single cell data from runsheet, save as RDS file

This script will create multiome objects if [01_multiome_signac.R](https://github.com/crchin/multiome_process/blob/main/01_multiome_signac.R) was not run, but will not contain velocity data

**Script:** [08_combined_multiome_2.R](https://github.com/crchin/multiome_process/blob/main/08_combined_multiome_2.R)

Input arguments:

  - argument 1: path to runsheet
  - argument 2: species to use (Human or Mouse)
  - argument 3 (optional): number of cores to use

*Example Usage:*

```R
Rscript ~/.scripts/08_combine_multiome.R ./ls_msobj_combine_runsheet.csv mouse 32
```

A work directory will be created within the directory that this script is run from. The combined object will be saved as "combined.multiome.sobj.rds" within this work folder

### Use harmony to correct batch effect in both ATAC and RNA assays
**Script:** [12_multiome_harmony_rds.R](https://github.com/crchin/multiome_process/blob/main/12_multiome_harmony_rds.R)

Input arguments:

  - argument 1: path to object - use the "combined.multiome.sobj.rds" file generated by [08_combined_multiome_2.R](https://github.com/crchin/multiome_process/blob/main/08_combined_multiome_2.R)
  - argument 2: object name - name to give the object
  - argument 3: batch name - name of the metadata column to correct for. orig.ident
  - argument 4 (optional): number of cores to use

*Example Usage:*

```R
Rscript ~/scripts/12_multiome_harmony_rds.R ./work/integrated.multiome.sobj.celltype.fine.celltype.rds ls_am_dm_multiome orig.ident
```

### Label multiome data by RNA using a reference single cell object
**Script:** [16_label_singlecell_3.R](https://github.com/crchin/multiome_process/blob/main/16_label_singlecell_3.R)

  - argument 1: Path to seurat or signac object as an RDS file
  - argument 2: Path to reference seurat or signac object as an RDS file
  - argument 3: Name of assay to use
  - argument 4+: Names of labeles to transfer

*Example Usage:*

```R
Rscript ~/scripts/16_label_singlecell.R ./work/integrated.multiome.sobj.rds /athena/masonlab/scratch/users/chc2077/references/gcb/20210512_melnick.int.sobj.RDS RNA celltype fine.celltype
```

